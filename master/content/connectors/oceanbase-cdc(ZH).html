

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>OceanBase CDC 连接器 &mdash; CDC Connectors for Apache Flink®  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Oracle CDC Connector" href="oracle-cdc.html" />
    <link rel="prev" title="OceanBase CDC Connector" href="oceanbase-cdc.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> CDC Connectors for Apache Flink®
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/index.html">快速上手</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Connectors</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="mongodb-cdc.html">MongoDB CDC Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongodb-cdc%28ZH%29.html">MongoDB CDC 连接器</a></li>
<li class="toctree-l2"><a class="reference internal" href="mysql-cdc.html">MySQL CDC Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="mysql-cdc%28ZH%29.html">MySQL CDC 连接器</a></li>
<li class="toctree-l2"><a class="reference internal" href="oceanbase-cdc.html">OceanBase CDC Connector</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">OceanBase CDC 连接器</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">依赖</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sql-jar">下载 SQL 客户端 JAR 包</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#oceanbase-oblogproxy">配置 OceanBase 数据库和 oblogproxy 服务</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id2">创建 OceanBase CDC 表</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">OceanBase CDC 连接器选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">支持的元数据</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">特性</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#at-least-once">At-Least-Once 处理</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">启动模式</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">消费提交日志</a></li>
<li class="toctree-l4"><a class="reference internal" href="#datastream-source">DataStream Source</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id8">数据类型映射</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mysql">Mysql 模式</a></li>
<li class="toctree-l4"><a class="reference internal" href="#oracle">Oracle 模式</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="oracle-cdc.html">Oracle CDC Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="postgres-cdc.html">Postgres CDC Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="sqlserver-cdc.html">SQLServer CDC Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="tidb-cdc.html">TiDB CDC Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="db2-cdc.html">Db2 CDC Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="vitess-cdc.html">Vitess CDC Connector</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../formats/index.html">Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../downloads.html">Downloads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../githublink.html"><a class="github-button" href="https://github.com/ververica/flink-cdc-connectors" data-color-scheme="no-preference: dark_high_contrast; light: dark_high_contrast; dark: dark_high_contrast;" data-size="large" data-show-count="true" aria-label="Star ververica/flink-cdc-connectors on GitHub">Star</a></a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CDC Connectors for Apache Flink®</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          <!--
 ~ Copyright 2023 Ververica Inc.
 ~
 ~ Licensed under the Apache License, Version 2.0 (the "License");
 ~ you may not use this file except in compliance with the License.
 ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
-->

<!-- Extend the RTD template to support user defined "Edit on Github" URL -->

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Connectors</a> &raquo;</li>
        
      <li>OceanBase CDC 连接器</li>
    
    
            <li class="wy-breadcrumbs-aside">
                
                    
                        <a href="http://github.com/ververica/flink-cdc-connectors/blob/master/docs/content/connectors/oceanbase-cdc(ZH).md" class="fa fa-github"> Edit on GitHub</a>
                    
                
            </li>
        
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section class="tex2jax_ignore mathjax_ignore" id="oceanbase-cdc">
<h1>OceanBase CDC 连接器<a class="headerlink" href="#oceanbase-cdc" title="Permalink to this headline">¶</a></h1>
<p>OceanBase CDC 连接器允许从 OceanBase 读取快照数据和增量数据。本文介绍了如何设置 OceanBase CDC 连接器以对 OceanBase 进行 SQL 查询。</p>
<section id="id1">
<h2>依赖<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>为了使用 OceanBase CDC 连接器，您必须提供相关的依赖信息。以下依赖信息适用于使用自动构建工具（如 Maven 或 SBT）构建的项目和带有 SQL JAR 包的 SQL 客户端。</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.ververica<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>flink-connector-oceanbase-cdc<span class="nt">&lt;/artifactId&gt;</span>
  <span class="c">&lt;!--  请使用已发布的版本依赖，snapshot 版本的依赖需要本地自行编译。 --&gt;</span>
  <span class="nt">&lt;version&gt;</span>2.5-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<p>如果您是要连接企业版的 OceanBase，您可能需要使用 OceanBase 官方的 JDBC 驱动，这时需要引入如下依赖。</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
   <span class="nt">&lt;groupId&gt;</span>com.oceanbase<span class="nt">&lt;/groupId&gt;</span>
   <span class="nt">&lt;artifactId&gt;</span>oceanbase-client<span class="nt">&lt;/artifactId&gt;</span>
   <span class="nt">&lt;version&gt;</span>2.4.2<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</section>
<section id="sql-jar">
<h2>下载 SQL 客户端 JAR 包<a class="headerlink" href="#sql-jar" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">下载链接仅在已发布版本可用，请在文档网站左下角选择浏览已发布的版本。</span></code></p>
<p>下载<a class="reference external" href="https://repo1.maven.org/maven2/com/ververica/flink-sql-connector-oceanbase-cdc/2.5-SNAPSHOT/flink-sql-connector-oceanbase-cdc-2.5-SNAPSHOT.jar">flink-sql-connector-oceanbase-cdc-2.5-SNAPSHOT.jar</a>  到 <code class="docutils literal notranslate"><span class="pre">&lt;FLINK_HOME&gt;/lib/</span></code> 目录下。</p>
<p><strong>注意:</strong> flink-sql-connector-oceanbase-cdc-XXX-SNAPSHOT 版本是开发分支<code class="docutils literal notranslate"><span class="pre">release-XXX</span></code>对应的快照版本，快照版本用户需要下载源代码并编译相应的 jar。用户应使用已经发布的版本，例如 <a class="reference external" href="https://mvnrepository.com/artifact/com.ververica/flink-sql-connector-oceanbase-cdc">flink-sql-connector-oceanbase-cdc-2.3.0.jar</a> 当前已发布的所有版本都可以在 Maven 中央仓库获取。</p>
<p>对于 JDBC 驱动，上述的 cdc jar 文件中已经包含了我们推荐的 MySQL 驱动版本 5.1.47。由于开源许可证的原因，我们不能在上述 cdc jar 文件中包含 OceanBase 的官方 JDBC 驱动，如果您需要使用它，可以从<a class="reference external" href="https://repo1.maven.org/maven2/com/oceanbase/oceanbase-client/2.4.2/oceanbase-client-2.4.2.jar">这里</a>下载，然后放到 <code class="docutils literal notranslate"><span class="pre">&lt;FLINK_HOME&gt;/lib/</span></code> 目录下，同时需要将配置项 <code class="docutils literal notranslate"><span class="pre">jdbc.driver</span></code> 设为 <code class="docutils literal notranslate"><span class="pre">com.oceanbase.jdbc.Driver</span></code>。</p>
<section id="oceanbase-oblogproxy">
<h3>配置 OceanBase 数据库和 oblogproxy 服务<a class="headerlink" href="#oceanbase-oblogproxy" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p>按照 <a class="reference external" href="https://github.com/oceanbase/oceanbase#quick-start">文档</a> 配置 OceanBase 集群。</p></li>
<li><p>在 sys 租户中，为 oblogproxy 创建一个带密码的用户。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mysql -h<span class="si">${</span><span class="nv">host</span><span class="si">}</span> -P<span class="si">${</span><span class="nv">port</span><span class="si">}</span> -uroot
mysql&gt; SHOW TENANT<span class="p">;</span>
mysql&gt; CREATE USER <span class="si">${</span><span class="nv">sys_username</span><span class="si">}</span> IDENTIFIED BY <span class="s1">&#39;${sys_password}&#39;</span><span class="p">;</span>
mysql&gt; GRANT ALL PRIVILEGES ON *.* TO <span class="si">${</span><span class="nv">sys_username</span><span class="si">}</span> WITH GRANT OPTION<span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>为你想要监控的租户创建一个用户，这个用户用来读取快照数据和变化事件数据。</p></li>
<li><p>OceanBase 社区版用户需要获取<code class="docutils literal notranslate"><span class="pre">rootserver-list</span></code>，可以使用以下命令获取：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mysql&gt; SHOW PARAMETERS LIKE <span class="s1">&#39;rootservice_list&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>OceanBase 企业版用户需要获取 <code class="docutils literal notranslate"><span class="pre">config-url</span></code>，可以使用以下命令获取：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mysql&gt; show parameters like <span class="s1">&#39;obconfig_url&#39;</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>按照 <a class="reference external" href="https://github.com/oceanbase/oblogproxy#getting-started">文档</a> 配置 oblogproxy。</p></li>
</ol>
</section>
</section>
<section id="id2">
<h2>创建 OceanBase CDC 表<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>使用以下命令，创建 OceanBase CDC 表：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- 每 3 秒做一次 checkpoint，用于测试，生产配置建议 5 到 10 分钟                  </span>
<span class="n">Flink</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SET</span> <span class="s1">&#39;execution.checkpointing.interval&#39;</span> <span class="o">=</span> <span class="s1">&#39;3s&#39;</span><span class="p">;</span>

<span class="c1">-- 在 Flink SQL 中创建 OceanBase 表 `orders`</span>
<span class="n">Flink</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">orders</span> <span class="p">(</span>
    <span class="n">order_id</span>     <span class="nb">INT</span><span class="p">,</span>
    <span class="n">order_date</span>   <span class="k">TIMESTAMP</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">customer_name</span> <span class="n">STRING</span><span class="p">,</span>
    <span class="n">price</span>        <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="n">product_id</span>   <span class="nb">INT</span><span class="p">,</span>
    <span class="n">order_status</span> <span class="nb">BOOLEAN</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">order_id</span><span class="p">)</span> <span class="k">NOT</span> <span class="n">ENFORCED</span>
<span class="p">)</span> <span class="k">WITH</span> <span class="p">(</span>
    <span class="s1">&#39;connector&#39;</span> <span class="o">=</span> <span class="s1">&#39;oceanbase-cdc&#39;</span><span class="p">,</span>
    <span class="s1">&#39;scan.startup.mode&#39;</span> <span class="o">=</span> <span class="s1">&#39;initial&#39;</span><span class="p">,</span>
    <span class="s1">&#39;username&#39;</span> <span class="o">=</span> <span class="s1">&#39;user@test_tenant#cluster_name&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span> <span class="o">=</span> <span class="s1">&#39;pswd&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tenant-name&#39;</span> <span class="o">=</span> <span class="s1">&#39;test_tenant&#39;</span><span class="p">,</span>
    <span class="s1">&#39;database-name&#39;</span> <span class="o">=</span> <span class="s1">&#39;^test_db$&#39;</span><span class="p">,</span>
    <span class="s1">&#39;table-name&#39;</span> <span class="o">=</span> <span class="s1">&#39;^orders$&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hostname&#39;</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;port&#39;</span> <span class="o">=</span> <span class="s1">&#39;2881&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rootserver-list&#39;</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1:2882:2881&#39;</span><span class="p">,</span>
    <span class="s1">&#39;logproxy.host&#39;</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;logproxy.port&#39;</span> <span class="o">=</span> <span class="s1">&#39;2983&#39;</span><span class="p">,</span>
    <span class="s1">&#39;working-mode&#39;</span> <span class="o">=</span> <span class="s1">&#39;memory&#39;</span>
<span class="p">);</span>

<span class="c1">-- 从表 orders 中读取快照数据和 binlog 数据</span>
<span class="n">Flink</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">orders</span><span class="p">;</span>
</pre></div>
</div>
<p>如果您使用的是企业版的 OceanBase Oracle 模式，您需要先添加 OceanBase 的官方 JDBC 驱动 jar 包到 Flink 环境，并且部署企业版的 oblogproxy 服务，然后通过以下命令创建 OceanBase CDC 表：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">Flink</span> <span class="k">SQL</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">orders</span> <span class="p">(</span>
    <span class="n">order_id</span>     <span class="nb">INT</span><span class="p">,</span>
    <span class="n">order_date</span>   <span class="k">TIMESTAMP</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">customer_name</span> <span class="n">STRING</span><span class="p">,</span>
    <span class="n">price</span>        <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="n">product_id</span>   <span class="nb">INT</span><span class="p">,</span>
    <span class="n">order_status</span> <span class="nb">BOOLEAN</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">order_id</span><span class="p">)</span> <span class="k">NOT</span> <span class="n">ENFORCED</span>
<span class="p">)</span> <span class="k">WITH</span> <span class="p">(</span>
    <span class="s1">&#39;connector&#39;</span> <span class="o">=</span> <span class="s1">&#39;oceanbase-cdc&#39;</span><span class="p">,</span>
    <span class="s1">&#39;scan.startup.mode&#39;</span> <span class="o">=</span> <span class="s1">&#39;initial&#39;</span><span class="p">,</span>
    <span class="s1">&#39;username&#39;</span> <span class="o">=</span> <span class="s1">&#39;user@test_tenant#cluster_name&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span> <span class="o">=</span> <span class="s1">&#39;pswd&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tenant-name&#39;</span> <span class="o">=</span> <span class="s1">&#39;test_tenant&#39;</span><span class="p">,</span>
    <span class="s1">&#39;database-name&#39;</span> <span class="o">=</span> <span class="s1">&#39;^test_db$&#39;</span><span class="p">,</span>
    <span class="s1">&#39;table-name&#39;</span> <span class="o">=</span> <span class="s1">&#39;^orders$&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hostname&#39;</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;port&#39;</span> <span class="o">=</span> <span class="s1">&#39;2881&#39;</span><span class="p">,</span>
    <span class="s1">&#39;compatible-mode&#39;</span> <span class="o">=</span> <span class="s1">&#39;oracle&#39;</span><span class="p">,</span>
    <span class="s1">&#39;jdbc.driver&#39;</span> <span class="o">=</span> <span class="s1">&#39;com.oceanbase.jdbc.Driver&#39;</span><span class="p">,</span>
    <span class="s1">&#39;config-url&#39;</span> <span class="o">=</span> <span class="s1">&#39;http://127.0.0.1:8080/services?Action=ObRootServiceInfo&amp;User_ID=xxx&amp;UID=xxx&amp;ObRegion=xxx&#39;</span><span class="p">,</span>
    <span class="s1">&#39;logproxy.host&#39;</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;logproxy.port&#39;</span> <span class="o">=</span> <span class="s1">&#39;2983&#39;</span><span class="p">,</span>
    <span class="s1">&#39;working-mode&#39;</span> <span class="o">=</span> <span class="s1">&#39;memory&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
<p>您也可以访问 Flink CDC 官网文档，快速体验将数据从 OceanBase 导入到 Elasticsearch。更多信息，参考 <a class="reference external" href="https://ververica.github.io/flink-cdc-connectors/release-2.2/content/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/oceanbase-tutorial-zh.html">Flink CDC 官网文档</a>。</p>
</section>
<section id="id3">
<h2>OceanBase CDC 连接器选项<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>OceanBase CDC 连接器包括用于 SQL 和 DataStream API 的选项，如下表所示。</p>
<p><em>注意</em>：连接器支持两种方式来指定需要监听的表，两种方式同时使用时会监听两种方式匹配的所有表。</p>
<ol class="simple">
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">database-name</span></code> 和 <code class="docutils literal notranslate"><span class="pre">table-name</span></code> 匹配正则表达式中的数据库和表名。 由于<code class="docutils literal notranslate"><span class="pre">obcdc</span></code>（以前的<code class="docutils literal notranslate"><span class="pre">liboblog</span></code>）现在只支持<code class="docutils literal notranslate"><span class="pre">fnmatch</span></code>匹配，我们不能直接使用正则过滤 changelog 事件，所以通过两个选项去匹配去指定监听表只能在<code class="docutils literal notranslate"><span class="pre">initial</span></code>启动模式下使用。</p></li>
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">table-list</span></code> 去匹配数据库名和表名的准确列表。</p></li>
</ol>
<div class="highlight">
    <table class="colwidths-auto docutils">
        <thead>
            <tr>
                <th class="text-left" style="width: 10%">配置项</th>
                <th class="text-left" style="width: 8%">是否必选</th>
                <th class="text-left" style="width: 7%">默认值</th>
                <th class="text-left" style="width: 10%">类型</th>
                <th class="text-left" style="width: 65%">描述</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>connector</td>
                <td>是</td>
                <td style="word-wrap: break-word;">无</td>
                <td>String</td>
                <td>指定要使用的连接器，此处为 <code>'oceanbase-cdc'</code>。</td>
            </tr>
            <tr>
                <td>scan.startup.mode</td>
                <td>是</td>
                <td style="word-wrap: break-word;">无</td>
                <td>String</td>
                <td>指定 OceanBase CDC 消费者的启动模式。可取值为<code>'initial'</code>,<code>'latest-offset'</code> or
                    <code>'timestamp'</code>。</td>
            </tr>
            <tr>
                <td>scan.startup.timestamp</td>
                <td>否</td>
                <td style="word-wrap: break-word;">无</td>
                <td>Long</td>
                <td>起始点的时间戳，单位为秒。仅在启动模式为 <code>'timestamp'</code> 时可用。</td>
            </tr>
            <tr>
                <td>username</td>
                <td>是</td>
                <td style="word-wrap: break-word;">无</td>
                <td>String</td>
                <td>连接 OceanBase 数据库的用户的名称。</td>
            </tr>
            <tr>
                <td>password</td>
                <td>是</td>
                <td style="word-wrap: break-word;">无</td>
                <td>String</td>
                <td>连接 OceanBase 数据库时使用的密码。</td>
            </tr>
            <tr>
                <td>tenant-name</td>
                <td>是</td>
                <td style="word-wrap: break-word;">无</td>
                <td>String</td>
                <td>待监控 OceanBase 数据库的租户名，应该填入精确值。</td>
            </tr>
            <tr>
                <td>database-name</td>
                <td>否</td>
                <td style="word-wrap: break-word;">无</td>
                <td>String</td>
                <td>待监控 OceanBase 数据库的数据库名，应该是正则表达式，该选项只支持和 'initial' 模式一起使用。</td>
            </tr>
            <tr>
                <td>table-name</td>
                <td>否</td>
                <td style="word-wrap: break-word;">无</td>
                <td>String</td>
                <td>待监控 OceanBase 数据库的表名，应该是正则表达式，该选项只支持和 'initial' 模式一起使用。</td>
            </tr>
            <tr>
                <td>table-list</td>
                <td>否</td>
                <td style="word-wrap: break-word;">无</td>
                <td>String</td>
                <td>待监控 OceanBase 数据库的全路径的表名列表，逗号分隔，如："db1.table1, db2.table2"。</td>
            </tr>
            <tr>
                <td>hostname</td>
                <td>否</td>
                <td style="word-wrap: break-word;">无</td>
                <td>String</td>
                <td>OceanBase 数据库或 OceanBbase 代理 ODP 的 IP 地址或主机名。</td>
            </tr>
            <tr>
                <td>port</td>
                <td>否</td>
                <td style="word-wrap: break-word;">无</td>
                <td>Integer</td>
                <td>
                    OceanBase 数据库服务器的整数端口号。可以是 OceanBase 服务器的 SQL 端口号（默认值为 2881）<br>
                    或 OceanBase代理服务的端口号（默认值为 2883）</td>
            </tr>
            <tr>
                <td>connect.timeout</td>
                <td>否</td>
                <td style="word-wrap: break-word;">30s</td>
                <td>Duration</td>
                <td>连接器在尝试连接到 OceanBase 数据库服务器超时前的最长时间。</td>
            </tr>
            <tr>
                <td>server-time-zone</td>
                <td>否</td>
                <td style="word-wrap: break-word;">+00:00</td>
                <td>String</td>
                <td>
                    数据库服务器中的会话时区，用户控制 OceanBase 的时间类型如何转换为 STRING。<br>
                    合法的值可以是格式为"±hh:mm"的 UTC 时区偏移量，<br>
                    如果 mysql 数据库中的时区信息表已创建，合法的值则可以是创建的时区。
                </td>
            </tr>
            <tr>
                <td>logproxy.host</td>
                <td>是</td>
                <td style="word-wrap: break-word;">无</td>
                <td>String</td>
                <td>OceanBase 日志代理服务 的 IP 地址或主机名。</td>
            </tr>
            <tr>
                <td>logproxy.port</td>
                <td>是</td>
                <td style="word-wrap: break-word;">无</td>
                <td>Integer</td>
                <td>OceanBase 日志代理服务 的端口号。</td>
            </tr>
            <tr>
                <td>logproxy.client.id</td>
                <td>否</td>
                <td style="word-wrap: break-word;">规则生成</td>
                <td>String</td>
                <td>OceanBase日志代理服务的客户端连接 ID，默认值的生成规则是 {flink_ip}_{process_id}_{timestamp}_{thread_id}_{tenant}。</td>
            </tr>
            <tr>
                <td>rootserver-list</td>
                <td>否</td>
                <td style="word-wrap: break-word;">无</td>
                <td>String</td>
                <td>OceanBase root 服务器列表，服务器格式为 `ip:rpc_port:sql_port`，<br>多个服务器地址使用英文分号 `;` 隔开，OceanBase 社区版本必填。</td>
            </tr>
            <tr>
                <td>config-url</td>
                <td>否</td>
                <td style="word-wrap: break-word;">无</td>
                <td>String</td>
                <td>从配置服务器获取服务器信息的 url, OceanBase 企业版本必填。</td>
            </tr>
            <tr>
                <td>working-mode</td>
                <td>否</td>
                <td style="word-wrap: break-word;">storage</td>
                <td>String</td>
                <td>日志代理中 `libobcdc` 的工作模式 , 可以是 `storage` 或 `memory`。</td>
            </tr>
            <tr>
                <td>compatible-mode</td>
                <td>否</td>
                <td style="word-wrap: break-word;">mysql</td>
                <td>String</td>
                <td>OceanBase 的兼容模式，可以是 `mysql` 或 `oracle`。</td>
            </tr>
            <tr>
                <td>jdbc.driver</td>
                <td>否</td>
                <td style="word-wrap: break-word;">com.mysql.jdbc.Driver</td>
                <td>String</td>
                <td>全量读取时使用的 jdbc 驱动类名。</td>
            </tr>
            <tr>
                <td>jdbc.properties.*</td>
                <td>否</td>
                <td style="word-wrap: break-word;">无</td>
                <td>String</td>
                <td>传递自定义 JDBC URL 属性的选项。用户可以传递自定义属性，如 'jdbc.properties.useSSL' = 'false'。</td>
            </tr>
        </tbody>
    </table>
</div>
</section>
<section id="id4">
<h2>支持的元数据<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>在创建表时，您可以使用以下格式的元数据作为只读列（VIRTUAL）。</p>
<table class="colwidths-auto docutils">
    <thead>
        <tr>
            <th class="text-left" style="width: 15%">列名</th>
            <th class="text-left" style="width: 30%">数据类型</th>
            <th class="text-left" style="width: 55%">描述</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>tenant_name</td>
            <td>STRING NOT NULL</td>
            <td>当前记录所属的租户名称。</td>
        </tr>
        <tr>
            <td>database_name</td>
            <td>STRING NOT NULL</td>
            <td>当前记录所属的库名。</td>
        </tr>
        <tr>
            <td>table_name</td>
            <td>STRING NOT NULL</td>
            <td>当前记录所属的表名称。</td>
        </tr>
        <tr>
            <td>op_ts</td>
            <td>TIMESTAMP_LTZ(3) NOT NULL</td>
            <td>该值表示此修改在数据库中发生的时间。如果这条记录是该表在快照阶段读取的记录，则该值返回 0。</td>
        </tr>
    </tbody>
</table>
<p>如下 SQL 展示了如何在表中使用这些元数据列：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">products</span> <span class="p">(</span>
    <span class="n">tenant_name</span> <span class="n">STRING</span> <span class="n">METADATA</span> <span class="k">FROM</span> <span class="s1">&#39;tenant_name&#39;</span> <span class="n">VIRTUAL</span><span class="p">,</span>
    <span class="n">db_name</span> <span class="n">STRING</span> <span class="n">METADATA</span> <span class="k">FROM</span> <span class="s1">&#39;database_name&#39;</span> <span class="n">VIRTUAL</span><span class="p">,</span>
    <span class="k">table_name</span> <span class="n">STRING</span> <span class="n">METADATA</span>  <span class="k">FROM</span> <span class="s1">&#39;table_name&#39;</span> <span class="n">VIRTUAL</span><span class="p">,</span>
    <span class="n">operation_ts</span> <span class="n">TIMESTAMP_LTZ</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">METADATA</span> <span class="k">FROM</span> <span class="s1">&#39;op_ts&#39;</span> <span class="n">VIRTUAL</span><span class="p">,</span>
    <span class="n">order_id</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="n">order_date</span> <span class="k">TIMESTAMP</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">customer_name</span> <span class="n">STRING</span><span class="p">,</span>
    <span class="n">price</span> <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="n">product_id</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="n">order_status</span> <span class="nb">BOOLEAN</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">order_id</span><span class="p">)</span> <span class="k">NOT</span> <span class="n">ENFORCED</span>
<span class="p">)</span> <span class="k">WITH</span> <span class="p">(</span>
   <span class="s1">&#39;connector&#39;</span> <span class="o">=</span> <span class="s1">&#39;oceanbase-cdc&#39;</span><span class="p">,</span>
   <span class="s1">&#39;scan.startup.mode&#39;</span> <span class="o">=</span> <span class="s1">&#39;initial&#39;</span><span class="p">,</span>
   <span class="s1">&#39;username&#39;</span> <span class="o">=</span> <span class="s1">&#39;user@test_tenant&#39;</span><span class="p">,</span>
   <span class="s1">&#39;password&#39;</span> <span class="o">=</span> <span class="s1">&#39;pswd&#39;</span><span class="p">,</span>
   <span class="s1">&#39;tenant-name&#39;</span> <span class="o">=</span> <span class="s1">&#39;test_tenant&#39;</span><span class="p">,</span>
   <span class="s1">&#39;database-name&#39;</span> <span class="o">=</span> <span class="s1">&#39;^test_db$&#39;</span><span class="p">,</span>
   <span class="s1">&#39;table-name&#39;</span> <span class="o">=</span> <span class="s1">&#39;^orders$&#39;</span><span class="p">,</span>
   <span class="s1">&#39;hostname&#39;</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
   <span class="s1">&#39;port&#39;</span> <span class="o">=</span> <span class="s1">&#39;2881&#39;</span><span class="p">,</span>
   <span class="s1">&#39;rootserver-list&#39;</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1:2882:2881&#39;</span><span class="p">,</span>
   <span class="s1">&#39;logproxy.host&#39;</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
   <span class="s1">&#39;logproxy.port&#39;</span> <span class="o">=</span> <span class="s1">&#39;2983&#39;</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="id5">
<h2>特性<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<section id="at-least-once">
<h3>At-Least-Once 处理<a class="headerlink" href="#at-least-once" title="Permalink to this headline">¶</a></h3>
<p>OceanBase CDC 连接器是一个 Flink Source 连接器。它将首先读取数据库快照，然后再读取变化事件，并进行 <strong>At-Least-Once 处理</strong>。</p>
<p>OceanBase 数据库是一个分布式数据库，它的日志也分散在不同的服务器上。由于没有类似 MySQL binlog 偏移量的位置信息，OceanBase 数据库用时间戳作为位置标记。为确保读取完整的数据，liboblog（读取 OceanBase 日志记录的 C++ 库）可能会在给定的时间戳之前读取一些日志数据。因此，OceanBase 数据库可能会读到起始点附近时间戳的重复数据，可保证 <strong>At-Least-Once 处理</strong>。</p>
</section>
<section id="id6">
<h3>启动模式<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>配置选项 <code class="docutils literal notranslate"><span class="pre">scan.startup.mode</span></code> 指定 OceanBase CDC 连接器的启动模式。可用取值包括：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">initial</span></code>（默认）：在首次启动时对受监视的数据库表执行初始快照，并继续读取最新的提交日志。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">latest-offset</span></code>：首次启动时，不对受监视的数据库表执行快照，仅从连接器启动时读取提交日志。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timestamp</span></code>：在首次启动时不对受监视的数据库表执行初始快照，仅从指定的 <code class="docutils literal notranslate"><span class="pre">scan.startup.timestamp</span></code> 读取最新的提交日志。</p></li>
</ul>
</section>
<section id="id7">
<h3>消费提交日志<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>OceanBase CDC 连接器使用 <a class="reference external" href="https://github.com/oceanbase/oblogclient">oblogclient</a> 消费 OceanBase日志代理服务 中的事务日志。</p>
</section>
<section id="datastream-source">
<h3>DataStream Source<a class="headerlink" href="#datastream-source" title="Permalink to this headline">¶</a></h3>
<p>OceanBase CDC 连接器也可以作为 DataStream Source 使用。您可以按照如下创建一个 SourceFunction：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.flink.api.common.typeinfo.TypeInformation</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.environment.StreamExecutionEnvironment</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.functions.source.SourceFunction</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.api.DataTypes</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.catalog.Column</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.catalog.ResolvedSchema</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.catalog.UniqueConstraint</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.data.RowData</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.runtime.typeutils.InternalTypeInfo</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.table.types.logical.RowType</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.ververica.cdc.connectors.oceanbase.OceanBaseSource</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ververica.cdc.connectors.oceanbase.source.RowDataOceanBaseDeserializationSchema</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ververica.cdc.connectors.oceanbase.table.OceanBaseDeserializationSchema</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ververica.cdc.connectors.oceanbase.table.StartupMode</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.time.ZoneId</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OceanBaseSourceExample</span> <span class="p">{</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
      <span class="n">ResolvedSchema</span> <span class="n">resolvedSchema</span> <span class="o">=</span>
              <span class="k">new</span> <span class="n">ResolvedSchema</span><span class="p">(</span>
                      <span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span>
                              <span class="n">Column</span><span class="p">.</span><span class="na">physical</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="n">DataTypes</span><span class="p">.</span><span class="na">INT</span><span class="p">().</span><span class="na">notNull</span><span class="p">()),</span>
                              <span class="n">Column</span><span class="p">.</span><span class="na">physical</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">DataTypes</span><span class="p">.</span><span class="na">STRING</span><span class="p">().</span><span class="na">notNull</span><span class="p">())),</span>
                      <span class="n">Collections</span><span class="p">.</span><span class="na">emptyList</span><span class="p">(),</span>
                      <span class="n">UniqueConstraint</span><span class="p">.</span><span class="na">primaryKey</span><span class="p">(</span><span class="s">&quot;pk&quot;</span><span class="p">,</span> <span class="n">Collections</span><span class="p">.</span><span class="na">singletonList</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)));</span>

      <span class="n">RowType</span> <span class="n">physicalDataType</span> <span class="o">=</span>
              <span class="p">(</span><span class="n">RowType</span><span class="p">)</span> <span class="n">resolvedSchema</span><span class="p">.</span><span class="na">toPhysicalRowDataType</span><span class="p">().</span><span class="na">getLogicalType</span><span class="p">();</span>
      <span class="n">TypeInformation</span><span class="o">&lt;</span><span class="n">RowData</span><span class="o">&gt;</span> <span class="n">resultTypeInfo</span> <span class="o">=</span> <span class="n">InternalTypeInfo</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">physicalDataType</span><span class="p">);</span>
      <span class="n">String</span> <span class="n">serverTimeZone</span> <span class="o">=</span> <span class="s">&quot;+00:00&quot;</span><span class="p">;</span>

      <span class="n">OceanBaseDeserializationSchema</span><span class="o">&lt;</span><span class="n">RowData</span><span class="o">&gt;</span> <span class="n">deserializer</span> <span class="o">=</span>
              <span class="n">RowDataOceanBaseDeserializationSchema</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
                      <span class="p">.</span><span class="na">setPhysicalRowType</span><span class="p">(</span><span class="n">physicalDataType</span><span class="p">)</span>
                      <span class="p">.</span><span class="na">setResultTypeInfo</span><span class="p">(</span><span class="n">resultTypeInfo</span><span class="p">)</span>
                      <span class="p">.</span><span class="na">setServerTimeZone</span><span class="p">(</span><span class="n">ZoneId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">serverTimeZone</span><span class="p">))</span>
                      <span class="p">.</span><span class="na">build</span><span class="p">();</span>

      <span class="n">SourceFunction</span><span class="o">&lt;</span><span class="n">RowData</span><span class="o">&gt;</span> <span class="n">oceanBaseSource</span> <span class="o">=</span>
              <span class="n">OceanBaseSource</span><span class="p">.</span><span class="o">&lt;</span><span class="n">RowData</span><span class="o">&gt;</span><span class="n">builder</span><span class="p">()</span>
                      <span class="p">.</span><span class="na">rsList</span><span class="p">(</span><span class="s">&quot;127.0.0.1:2882:2881&quot;</span><span class="p">)</span>
                      <span class="p">.</span><span class="na">startupMode</span><span class="p">(</span><span class="n">StartupMode</span><span class="p">.</span><span class="na">INITIAL</span><span class="p">)</span>
                      <span class="p">.</span><span class="na">username</span><span class="p">(</span><span class="s">&quot;user@test_tenant&quot;</span><span class="p">)</span>
                      <span class="p">.</span><span class="na">password</span><span class="p">(</span><span class="s">&quot;pswd&quot;</span><span class="p">)</span>
                      <span class="p">.</span><span class="na">tenantName</span><span class="p">(</span><span class="s">&quot;test_tenant&quot;</span><span class="p">)</span>
                      <span class="p">.</span><span class="na">databaseName</span><span class="p">(</span><span class="s">&quot;^test_db$&quot;</span><span class="p">)</span>
                      <span class="p">.</span><span class="na">tableName</span><span class="p">(</span><span class="s">&quot;^test_table$&quot;</span><span class="p">)</span>
                      <span class="p">.</span><span class="na">hostname</span><span class="p">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">)</span>
                      <span class="p">.</span><span class="na">port</span><span class="p">(</span><span class="mi">2881</span><span class="p">)</span>
                      <span class="p">.</span><span class="na">compatibleMode</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">)</span>
                      <span class="p">.</span><span class="na">jdbcDriver</span><span class="p">(</span><span class="s">&quot;com.mysql.jdbc.Driver&quot;</span><span class="p">)</span>
                      <span class="p">.</span><span class="na">logProxyHost</span><span class="p">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">)</span>
                      <span class="p">.</span><span class="na">logProxyPort</span><span class="p">(</span><span class="mi">2983</span><span class="p">)</span>
                      <span class="p">.</span><span class="na">serverTimeZone</span><span class="p">(</span><span class="n">serverTimeZone</span><span class="p">)</span>
                      <span class="p">.</span><span class="na">deserializer</span><span class="p">(</span><span class="n">deserializer</span><span class="p">)</span>
                      <span class="p">.</span><span class="na">build</span><span class="p">();</span>

      <span class="n">StreamExecutionEnvironment</span> <span class="n">env</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="p">.</span><span class="na">getExecutionEnvironment</span><span class="p">();</span>

      <span class="c1">// enable checkpoint</span>
      <span class="n">env</span><span class="p">.</span><span class="na">enableCheckpointing</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>

      <span class="n">env</span><span class="p">.</span><span class="na">addSource</span><span class="p">(</span><span class="n">oceanBaseSource</span><span class="p">).</span><span class="na">print</span><span class="p">().</span><span class="na">setParallelism</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="n">env</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="s">&quot;Print OceanBase Snapshot + Change Events&quot;</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="id8">
<h2>数据类型映射<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<section id="mysql">
<h3>Mysql 模式<a class="headerlink" href="#mysql" title="Permalink to this headline">¶</a></h3>
<div class="wy-table-responsive">
    <table class="colwidths-auto docutils">
        <thead>
            <tr>
                <th class="text-left">OceanBase 数据类型</th>
                <th class="text-left">Flink SQL 类型</th>
                <th class="text-left">描述</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    BOOLEAN<br>
                    TINYINT(1)<br>
                    BIT(1)
                </td>
                <td>BOOLEAN</td>
                <td></td>
            </tr>
            <tr>
                <td>TINYINT</td>
                <td>TINYINT</td>
                <td></td>
            </tr>
            <tr>
                <td>
                    SMALLINT<br>
                    TINYINT UNSIGNED
                </td>
                <td>SMALLINT</td>
                <td></td>
            </tr>
            <tr>
                <td>
                    INT<br>
                    MEDIUMINT<br>
                    SMALLINT UNSIGNED
                </td>
                <td>INT</td>
                <td></td>
            </tr>
            <tr>
                <td>
                    BIGINT<br>
                    INT UNSIGNED
                </td>
                <td>BIGINT</td>
                <td></td>
            </tr>
            <tr>
                <td>BIGINT UNSIGNED</td>
                <td>DECIMAL(20, 0)</td>
                <td></td>
            </tr>
            <tr>
                <td>
                    REAL<br>
                    FLOAT
                </td>
                <td>FLOAT</td>
                <td></td>
            </tr>
            <tr>
                <td>
                    DOUBLE
                </td>
                <td>DOUBLE</td>
                <td></td>
            </tr>
            <tr>
                <td>
                    NUMERIC(p, s)<br>
                    DECIMAL(p, s)<br>
                    where p <= 38 </td>
                <td>DECIMAL(p, s)</td>
                <td></td>
            </tr>
            <tr>
                <td>
                    NUMERIC(p, s)<br>
                    DECIMAL(p, s)<br>
                    where 38 < p <=65 </td>
                <td>STRING</td>
                <td>
                    DECIMAL 等同于 NUMERIC。在 OceanBase 数据库中，DECIMAL 数据类型的精度最高为 65。<br>
                    但在 Flink 中，DECIMAL 的最高精度为 38。因此，<br>
                    如果你定义了一个精度大于 38 的 DECIMAL 列，你应当将其映射为 STRING，以避免精度损失。
                </td>
            </tr>
            <tr>
                <td>DATE</td>
                <td>DATE</td>
                <td></td>
            </tr>
            <tr>
                <td>TIME [(p)]</td>
                <td>TIME [(p)]</td>
                <td></td>
            </tr>
            <tr>
                <td>DATETIME [(p)]</td>
                <td>TIMESTAMP [(p)]</td>
                <td></td>
            </tr>
            <tr>
                <td>TIMESTAMP [(p)]</td>
                <td>TIMESTAMP_LTZ [(p)]</td>
                <td></td>
            </tr>
            <tr>
                <td>CHAR(n)</td>
                <td>CHAR(n)</td>
                <td></td>
            </tr>
            <tr>
                <td>VARCHAR(n)</td>
                <td>VARCHAR(n)</td>
                <td></td>
            </tr>
            <tr>
                <td>BIT(n)</td>
                <td>BINARY(⌈n/8⌉)</td>
                <td></td>
            </tr>
            <tr>
                <td>BINARY(n)</td>
                <td>BINARY(n)</td>
                <td></td>
            </tr>
            <tr>
                <td>VARBINARY(N)</td>
                <td>VARBINARY(N)</td>
                <td></td>
            </tr>
            <tr>
                <td>
                    TINYTEXT<br>
                    TEXT<br>
                    MEDIUMTEXT<br>
                    LONGTEXT
                </td>
                <td>STRING</td>
                <td></td>
            </tr>
            <tr>
                <td>
                    TINYBLOB<br>
                    BLOB<br>
                    MEDIUMBLOB<br>
                    LONGBLOB
                </td>
                <td>BYTES</td>
                <td></td>
            </tr>
            <tr>
                <td>YEAR</td>
                <td>INT</td>
                <td></td>
            </tr>
            <tr>
                <td>ENUM</td>
                <td>STRING</td>
                <td></td>
            </tr>
            <tr>
                <td>SET</td>
                <td>ARRAY&lt;STRING&gt;</td>
                <td>
                    因为 OceanBase 的 SET 类型是用包含一个或多个值的字符串对象表示，<br>
                    所以映射到 Flink 时是一个字符串数组
                </td>
            </tr>
            <tr>
                <td>JSON</td>
                <td>STRING</td>
                <td>JSON 类型的数据在 Flink 中会转化为 JSON 格式的字符串</td>
            </tr>
        </tbody>
    </table>
</div>
</section>
<section id="oracle">
<h3>Oracle 模式<a class="headerlink" href="#oracle" title="Permalink to this headline">¶</a></h3>
<div class="wy-table-responsive">
    <table class="colwidths-auto docutils">
        <thead>
            <tr>
                <th class="text-left">OceanBase type</th>
                <th class="text-left">Flink SQL type</th>
                <th class="text-left">NOTE</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>NUMBER(1)</td>
                <td>BOOLEAN</td>
                <td></td>
            </tr>
            <tr>
                <td>NUMBER(p, s <= 0), p - s < 3 </td>
                <td>TINYINT</td>
                <td></td>
            </tr>
            <tr>
                <td>NUMBER(p, s <= 0), p - s < 5 </td>
                <td>SMALLINT</td>
                <td></td>
            </tr>
            <tr>
                <td>NUMBER(p, s <= 0), p - s < 10 </td>
                <td>INT</td>
                <td></td>
            </tr>
            <tr>
                <td>NUMBER(p, s <= 0), p - s < 19 </td>
                <td>BIGINT</td>
                <td></td>
            </tr>
            <tr>
                <td>NUMBER(p, s <= 0), 19 <=p - s <=38</td>
                <td>DECIMAL(p - s, 0)</td>
                <td></td>
            </tr>
            <tr>
                <td>NUMBER(p, s > 0)</td>
                <td>DECIMAL(p, s)</td>
            </tr>
            <tr>
                <td>NUMBER(p, s <= 0), p - s> 38 </td>
                <td>STRING</td>
                <td></td>
            </tr>
            <tr>
                <td>
                    FLOAT<br>
                    BINARY_FLOAT
                </td>
                <td>FLOAT</td>
                <td></td>
            </tr>
            <tr>
                <td>BINARY_DOUBLE</td>
                <td>DOUBLE</td>
                <td></td>
            </tr>
            <tr>
                <td>
                    DATE<br>
                    TIMESTAMP [(p)]
                </td>
                <td>TIMESTAMP [(p)]</td>
                <td></td>
            </tr>
            <tr>
                <td>
                    CHAR(n)<br>
                    NCHAR(n)<br>
                    VARCHAR(n)<br>
                    VARCHAR2(n)<br>
                    NVARCHAR2(n)<br>
                    CLOB<br>
                </td>
                <td>STRING</td>
                <td></td>
            </tr>
            <tr>
                <td>
                    RAW<br>
                    BLOB<br>
                    ROWID
                </td>
                <td>BYTES</td>
                <td></td>
            </tr>
        </tbody>
    </table>
</div>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="oracle-cdc.html" class="btn btn-neutral float-right" title="Oracle CDC Connector" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="oceanbase-cdc.html" class="btn btn-neutral float-left" title="OceanBase CDC Connector" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2023, Ververica GmbH; Apache Flink, Flink®, Apache®, the squirrel logo, and the Apache feather logo are either registered trademarks or trademarks of The Apache Software Foundation.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  <!--
 ~ Copyright 2023 Ververica Inc.
 ~
 ~ Licensed under the Apache License, Version 2.0 (the "License");
 ~ you may not use this file except in compliance with the License.
 ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
-->



<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      version: master
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        
        <dl>
            <dt>Versions</dt>
            
             <strong> 
            <dd><a href="/flink-cdc-connectors/master/">master</a></dd>
             </strong> 
            
            
            <dd><a href="/flink-cdc-connectors/release-1.4/">release-1.4</a></dd>
            
            
            
            <dd><a href="/flink-cdc-connectors/release-2.0/">release-2.0</a></dd>
            
            
            
            <dd><a href="/flink-cdc-connectors/release-2.1/">release-2.1</a></dd>
            
            
            
            <dd><a href="/flink-cdc-connectors/release-2.2/">release-2.2</a></dd>
            
            
            
            <dd><a href="/flink-cdc-connectors/release-2.3/">release-2.3</a></dd>
            
            
            
            <dd><a href="/flink-cdc-connectors/release-2.4/">release-2.4</a></dd>
            
            
        </dl>
        
        
        <hr/>
        Free document hosting provided by <a href="http://www.readthedocs.org">Read the
        Docs</a>.

    </div>
</div>

<!-- Place this tag in your head or just before your close body tag. -->
<script async defer
        src="https://ververica.github.io/flink-cdc-connectors/master/_static/button.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>