

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>SQLServer CDC Connector &mdash; CDC Connectors for Apache Flink®  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="TiDB CDC Connector" href="tidb-cdc.html" />
    <link rel="prev" title="Postgres CDC Connector" href="postgres-cdc.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> CDC Connectors for Apache Flink®
          

          
          </a>

          
            
            
              <div class="version">
                release-2.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/index.html">快速上手</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Connectors</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="mongodb-cdc.html">MongoDB CDC Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="mongodb-cdc%28ZH%29.html">MongoDB CDC 连接器</a></li>
<li class="toctree-l2"><a class="reference internal" href="mysql-cdc.html">MySQL CDC Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="mysql-cdc%28ZH%29.html">MySQL CDC 连接器</a></li>
<li class="toctree-l2"><a class="reference internal" href="oceanbase-cdc.html">OceanBase CDC Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="oceanbase-cdc%28ZH%29.html">OceanBase CDC 连接器</a></li>
<li class="toctree-l2"><a class="reference internal" href="oracle-cdc.html">Oracle CDC Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="postgres-cdc.html">Postgres CDC Connector</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">SQLServer CDC Connector</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dependencies">Dependencies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#maven-dependency">Maven dependency</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sql-client-jar">SQL Client JAR</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#setup-sqlserver-database">Setup SQLServer Database</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-create-a-sqlserver-cdc-table">How to create a SQLServer CDC table</a></li>
<li class="toctree-l3"><a class="reference internal" href="#connector-options">Connector Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#available-metadata">Available Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="#limitation">Limitation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#can-t-perform-checkpoint-during-scanning-snapshot-of-tables">Can’t perform checkpoint during scanning snapshot of tables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#features">Features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#exactly-once-processing">Exactly-Once Processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#startup-reading-position">Startup Reading Position</a></li>
<li class="toctree-l4"><a class="reference internal" href="#single-thread-reading">Single Thread Reading</a></li>
<li class="toctree-l4"><a class="reference internal" href="#datastream-source">DataStream Source</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#data-type-mapping">Data Type Mapping</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tidb-cdc.html">TiDB CDC Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="db2-cdc.html">Db2 CDC Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="vitess-cdc.html">Vitess CDC Connector</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../formats/index.html">Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../downloads.html">Downloads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../githublink.html"><a class="github-button" href="https://github.com/ververica/flink-cdc-connectors" data-color-scheme="no-preference: dark_high_contrast; light: dark_high_contrast; dark: dark_high_contrast;" data-size="large" data-show-count="true" aria-label="Star ververica/flink-cdc-connectors on GitHub">Star</a></a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CDC Connectors for Apache Flink®</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          <!--
 ~ Copyright 2023 Ververica Inc.
 ~
 ~ Licensed under the Apache License, Version 2.0 (the "License");
 ~ you may not use this file except in compliance with the License.
 ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
-->

<!-- Extend the RTD template to support user defined "Edit on Github" URL -->

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Connectors</a> &raquo;</li>
        
      <li>SQLServer CDC Connector</li>
    
    
            <li class="wy-breadcrumbs-aside">
                
                    
                        <a href="http://github.com/ververica/flink-cdc-connectors/blob/release-2.4/docs/content/connectors/sqlserver-cdc.md" class="fa fa-github"> Edit on GitHub</a>
                    
                
            </li>
        
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section class="tex2jax_ignore mathjax_ignore" id="sqlserver-cdc-connector">
<h1>SQLServer CDC Connector<a class="headerlink" href="#sqlserver-cdc-connector" title="Permalink to this headline">¶</a></h1>
<p>The SQLServer CDC connector allows for reading snapshot data and incremental data from SQLServer database. This document describes how to setup the SQLServer CDC connector to run SQL queries against SQLServer databases.</p>
<section id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<p>In order to setup the SQLServer CDC connector, the following table provides dependency information for both projects using a build automation tool (such as Maven or SBT) and SQL Client with SQL JAR bundles.</p>
<section id="maven-dependency">
<h3>Maven dependency<a class="headerlink" href="#maven-dependency" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;dependency&gt;
  &lt;groupId&gt;com.ververica&lt;/groupId&gt;
  &lt;artifactId&gt;flink-connector-sqlserver-cdc&lt;/artifactId&gt;
  &lt;!-- The dependency is available only for stable releases, SNAPSHOT dependency need build by yourself. --&gt;
  &lt;version&gt;2.4.0&lt;/version&gt;
&lt;/dependency&gt;
</pre></div>
</div>
</section>
<section id="sql-client-jar">
<h3>SQL Client JAR<a class="headerlink" href="#sql-client-jar" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Download</span> <span class="pre">link</span> <span class="pre">is</span> <span class="pre">available</span> <span class="pre">only</span> <span class="pre">for</span> <span class="pre">stable</span> <span class="pre">releases.</span></code></p>
<p>Download <a class="reference external" href="https://repo1.maven.org/maven2/com/ververica/flink-sql-connector-sqlserver-cdc/2.4.0/flink-sql-connector-sqlserver-cdc-2.4.0.jar">flink-sql-connector-sqlserver-cdc-2.4.0.jar</a> and put it under <code class="docutils literal notranslate"><span class="pre">&lt;FLINK_HOME&gt;/lib/</span></code>.</p>
<p><strong>Note:</strong> flink-sql-connector-sqlserver-cdc-XXX-SNAPSHOT version is the code corresponding to the development branch. Users need to download the source code and compile the corresponding jar. Users should use the released version, such as <a class="reference external" href="https://mvnrepository.com/artifact/com.ververica/flink-sql-connector-sqlserver-cdc">flink-sql-connector-sqlserver-cdc-2.2.1.jar</a>, the released version will be available in the Maven central warehouse.</p>
</section>
</section>
<section id="setup-sqlserver-database">
<h2>Setup SQLServer Database<a class="headerlink" href="#setup-sqlserver-database" title="Permalink to this headline">¶</a></h2>
<p>A SQL Server administrator must enable change data capture on the source tables that you want to capture. The database must already be enabled for CDC. To enable CDC on a table, a SQL Server administrator runs the stored procedure <code class="docutils literal notranslate"><span class="pre">sys.sp_cdc_enable_table</span></code> for the table.</p>
<p><strong>Prerequisites:</strong></p>
<ul class="simple">
<li><p>CDC is enabled on the SQL Server database.</p></li>
<li><p>The SQL Server Agent is running.</p></li>
<li><p>You are a member of the db_owner fixed database role for the database.</p></li>
</ul>
<p><strong>Procedure:</strong></p>
<ul class="simple">
<li><p>Connect to the SQL Server database by database management studio.</p></li>
<li><p>Run the following SQL statement to enable CDC on the table.</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">USE</span> <span class="n">MyDB</span>
<span class="k">GO</span>

<span class="k">EXEC</span> <span class="n">sys</span><span class="p">.</span><span class="n">sp_cdc_enable_table</span>
<span class="o">@</span><span class="n">source_schema</span> <span class="o">=</span> <span class="n">N</span><span class="s1">&#39;dbo&#39;</span><span class="p">,</span>     <span class="c1">-- Specifies the schema of the source table.</span>
<span class="o">@</span><span class="n">source_name</span>   <span class="o">=</span> <span class="n">N</span><span class="s1">&#39;MyTable&#39;</span><span class="p">,</span> <span class="c1">-- Specifies the name of the table that you want to capture.</span>
<span class="o">@</span><span class="n">role_name</span>     <span class="o">=</span> <span class="n">N</span><span class="s1">&#39;MyRole&#39;</span><span class="p">,</span>  <span class="c1">-- Specifies a role MyRole to which you can add users to whom you want to grant SELECT permission on the captured columns of the source table. Users in the sysadmin or db_owner role also have access to the specified change tables. Set the value of @role_name to NULL, to allow only members in the sysadmin or db_owner to have full access to captured information.</span>
<span class="o">@</span><span class="n">filegroup_name</span> <span class="o">=</span> <span class="n">N</span><span class="s1">&#39;MyDB_CT&#39;</span><span class="p">,</span><span class="c1">-- Specifies the filegroup where SQL Server places the change table for the captured table. The named filegroup must already exist. It is best not to locate change tables in the same filegroup that you use for source tables.</span>
<span class="o">@</span><span class="n">supports_net_changes</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">GO</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Verifying that the user has access to the CDC table</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">--The following example runs the stored procedure sys.sp_cdc_help_change_data_capture on the database MyDB:</span>
<span class="n">USE</span> <span class="n">MyDB</span><span class="p">;</span>
<span class="k">GO</span>
<span class="k">EXEC</span> <span class="n">sys</span><span class="p">.</span><span class="n">sp_cdc_help_change_data_capture</span>
<span class="k">GO</span>
</pre></div>
</div>
<p>The query returns configuration information for each table in the database that is enabled for CDC and that contains change data that the caller is authorized to access. If the result is empty, verify that the user has privileges to access both the capture instance and the CDC tables.</p>
</section>
<section id="how-to-create-a-sqlserver-cdc-table">
<h2>How to create a SQLServer CDC table<a class="headerlink" href="#how-to-create-a-sqlserver-cdc-table" title="Permalink to this headline">¶</a></h2>
<p>The SqlServer CDC table can be defined as following:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- register a SqlServer table &#39;orders&#39; in Flink SQL</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">orders</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="n">order_date</span> <span class="nb">DATE</span><span class="p">,</span>
    <span class="n">purchaser</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="n">quantity</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="n">product_id</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">NOT</span> <span class="n">ENFORCED</span>
<span class="p">)</span> <span class="k">WITH</span> <span class="p">(</span>
    <span class="s1">&#39;connector&#39;</span> <span class="o">=</span> <span class="s1">&#39;sqlserver-cdc&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hostname&#39;</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
    <span class="s1">&#39;port&#39;</span> <span class="o">=</span> <span class="s1">&#39;1433&#39;</span><span class="p">,</span>
    <span class="s1">&#39;username&#39;</span> <span class="o">=</span> <span class="s1">&#39;sa&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span> <span class="o">=</span> <span class="s1">&#39;Password!&#39;</span><span class="p">,</span>
    <span class="s1">&#39;database-name&#39;</span> <span class="o">=</span> <span class="s1">&#39;inventory&#39;</span><span class="p">,</span>
    <span class="s1">&#39;table-name&#39;</span> <span class="o">=</span> <span class="s1">&#39;dob.orders&#39;</span>
<span class="p">);</span>

<span class="c1">-- read snapshot and binlogs from orders table</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">orders</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="connector-options">
<h2>Connector Options<a class="headerlink" href="#connector-options" title="Permalink to this headline">¶</a></h2>
<div class="highlight">
<table class="colwidths-auto docutils">
   <thead>
      <tr>
        <th class="text-left" style="width: 25%">Option</th>
        <th class="text-left" style="width: 8%">Required</th>
        <th class="text-left" style="width: 7%">Default</th>
        <th class="text-left" style="width: 10%">Type</th>
        <th class="text-left" style="width: 50%">Description</th>
      </tr>
    </thead>
    <tbody>
    <tr>
      <td>connector</td>
      <td>required</td>
      <td style="word-wrap: break-word;">(none)</td>
      <td>String</td>
      <td>Specify what connector to use, here should be <code>'sqlserver-cdc'</code>.</td>
    </tr>
    <tr>
      <td>hostname</td>
      <td>required</td>
      <td style="word-wrap: break-word;">(none)</td>
      <td>String</td>
      <td>IP address or hostname of the SQLServer database.</td>
    </tr>
    <tr>
      <td>username</td>
      <td>required</td>
      <td style="word-wrap: break-word;">(none)</td>
      <td>String</td>
      <td>Username to use when connecting to the SQLServer database.</td>
    </tr>
    <tr>
      <td>password</td>
      <td>required</td>
      <td style="word-wrap: break-word;">(none)</td>
      <td>String</td>
      <td>Password to use when connecting to the SQLServer database.</td>
    </tr>
    <tr>
      <td>database-name</td>
      <td>required</td>
      <td style="word-wrap: break-word;">(none)</td>
      <td>String</td>
      <td>Database name of the SQLServer database to monitor.</td>
    </tr> 
    <tr>
      <td>table-name</td>
      <td>required</td>
      <td style="word-wrap: break-word;">(none)</td>
      <td>String</td>
      <td>Table name of the SQLServer database to monitor, e.g.: "db1.table1"</td>
    </tr>
    <tr>
      <td>port</td>
      <td>optional</td>
      <td style="word-wrap: break-word;">1433</td>
      <td>Integer</td>
      <td>Integer port number of the SQLServer database.</td>
    </tr>
    <tr>
      <td>server-time-zone</td>
      <td>optional</td>
      <td style="word-wrap: break-word;">UTC</td>
      <td>String</td>
      <td>The session time zone in database server, e.g. "Asia/Shanghai".</td>
    </tr>
    <tr>
      <td>scan.incremental.snapshot.enabled</td>
      <td>optional</td>
      <td style="word-wrap: break-word;">true</td>
      <td>Boolean</td>
      <td>Whether enable parallelism snapshot.</td>
    </tr>
    <tr>
      <td>chunk-meta.group.size</td>
      <td>optional</td>
      <td style="word-wrap: break-word;">1000</td>
      <td>Integer</td>
      <td>The group size of chunk meta, if the meta size exceeds the group size, the meta will be divided into multiple groups.</td>
    </tr>
    <tr>
      <td>chunk-key.even-distribution.factor.lower-bound</td>
      <td>optional</td>
      <td style="word-wrap: break-word;">0.05d</td>
      <td>Double</td>
      <td>The lower bound of chunk key distribution factor. The distribution factor is used to determine whether the table is evenly distribution or not. 
          The table chunks would use evenly calculation optimization when the data distribution is even, and the query for splitting would happen when it is uneven. 
          The distribution factor could be calculated by (MAX(id) - MIN(id) + 1) / rowCount.</td>
    </tr> 
    <tr>
      <td>chunk-key.even-distribution.factor.upper-bound</td>
      <td>optional</td>
      <td style="word-wrap: break-word;">1000.0d</td>
      <td>Double</td>
      <td>The upper bound of chunk key distribution factor. The distribution factor is used to determine whether the table is evenly distribution or not. 
          The table chunks would use evenly calculation optimization when the data distribution is even, and the query for splitting would happen when it is uneven. 
          The distribution factor could be calculated by (MAX(id) - MIN(id) + 1) / rowCount.</td>
    </tr>
   <tr>
      <td>debezium.*</td>
      <td>optional</td>
      <td style="word-wrap: break-word;">(none)</td>
      <td>String</td>
      <td>Pass-through Debezium's properties to Debezium Embedded Engine which is used to capture data changes from SQLServer.
          For example: <code>'debezium.snapshot.mode' = 'initial_only'</code>.
          See more about the <a href="https://debezium.io/documentation/reference/1.9/connectors/sqlserver.html#sqlserver-required-connector-configuration-properties">Debezium's SQLServer Connector properties</a></td> 
    </tr>
    <tr>
      <td>scan.incremental.close-idle-reader.enabled</td>
      <td>optional</td>
      <td style="word-wrap: break-word;">false</td>
      <td>Boolean</td>
      <td>Whether to close idle readers at the end of the snapshot phase. The flink version is required to be greater than or equal to 1.14 when 'execution.checkpointing.checkpoints-after-tasks-finish.enabled' is set to true.</td>
    </tr>
    </tbody>
</table>    
</div>
</section>
<section id="available-metadata">
<h2>Available Metadata<a class="headerlink" href="#available-metadata" title="Permalink to this headline">¶</a></h2>
<p>The following format metadata can be exposed as read-only (VIRTUAL) columns in a table definition.</p>
<table class="colwidths-auto docutils">
  <thead>
     <tr>
       <th class="text-left" style="width: 15%">Key</th>
       <th class="text-left" style="width: 30%">DataType</th>
       <th class="text-left" style="width: 55%">Description</th>
     </tr>
  </thead>
  <tbody>
    <tr>
      <td>table_name</td>
      <td>STRING NOT NULL</td>
      <td>Name of the table that contain the row.</td>
    </tr>
    <tr>
      <td>schema_name</td>
      <td>STRING NOT NULL</td>
      <td>Name of the schema that contain the row.</td>
    </tr>    
    <tr>
      <td>database_name</td>
      <td>STRING NOT NULL</td>
      <td>Name of the database that contain the row.</td>
    </tr>
    <tr>
      <td>op_ts</td>
      <td>TIMESTAMP_LTZ(3) NOT NULL</td>
      <td>It indicates the time that the change was made in the database. <br>If the record is read from snapshot of the table instead of the change stream, the value is always 0.</td>
    </tr>
  </tbody>
</table>
</section>
<section id="limitation">
<h2>Limitation<a class="headerlink" href="#limitation" title="Permalink to this headline">¶</a></h2>
<section id="can-t-perform-checkpoint-during-scanning-snapshot-of-tables">
<h3>Can’t perform checkpoint during scanning snapshot of tables<a class="headerlink" href="#can-t-perform-checkpoint-during-scanning-snapshot-of-tables" title="Permalink to this headline">¶</a></h3>
<p>During scanning snapshot of database tables, since there is no recoverable position, we can’t perform checkpoints. In order to not perform checkpoints, SqlServer CDC source will keep the checkpoint waiting to timeout. The timeout checkpoint will be recognized as failed checkpoint, by default, this will trigger a failover for the Flink job. So if the database table is large, it is recommended to add following Flink configurations to avoid failover because of the timeout checkpoints:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">execution</span><span class="o">.</span><span class="n">checkpointing</span><span class="o">.</span><span class="n">interval</span><span class="p">:</span> <span class="mi">10</span><span class="nb">min</span>
<span class="n">execution</span><span class="o">.</span><span class="n">checkpointing</span><span class="o">.</span><span class="n">tolerable</span><span class="o">-</span><span class="n">failed</span><span class="o">-</span><span class="n">checkpoints</span><span class="p">:</span> <span class="mi">100</span>
<span class="n">restart</span><span class="o">-</span><span class="n">strategy</span><span class="p">:</span> <span class="n">fixed</span><span class="o">-</span><span class="n">delay</span>
<span class="n">restart</span><span class="o">-</span><span class="n">strategy</span><span class="o">.</span><span class="n">fixed</span><span class="o">-</span><span class="n">delay</span><span class="o">.</span><span class="n">attempts</span><span class="p">:</span> <span class="mi">2147483647</span>
</pre></div>
</div>
<p>The extended CREATE TABLE example demonstrates the syntax for exposing these metadata fields:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">products</span> <span class="p">(</span>
    <span class="k">table_name</span> <span class="n">STRING</span> <span class="n">METADATA</span>  <span class="k">FROM</span> <span class="s1">&#39;table_name&#39;</span> <span class="n">VIRTUAL</span><span class="p">,</span>
    <span class="k">schema_name</span> <span class="n">STRING</span> <span class="n">METADATA</span>  <span class="k">FROM</span> <span class="s1">&#39;schema_name&#39;</span> <span class="n">VIRTUAL</span><span class="p">,</span>
    <span class="n">db_name</span> <span class="n">STRING</span> <span class="n">METADATA</span> <span class="k">FROM</span> <span class="s1">&#39;database_name&#39;</span> <span class="n">VIRTUAL</span><span class="p">,</span>
    <span class="n">operation_ts</span> <span class="n">TIMESTAMP_LTZ</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">METADATA</span> <span class="k">FROM</span> <span class="s1">&#39;op_ts&#39;</span> <span class="n">VIRTUAL</span><span class="p">,</span>
    <span class="n">id</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">name</span> <span class="n">STRING</span><span class="p">,</span>
    <span class="n">description</span> <span class="n">STRING</span><span class="p">,</span>
    <span class="n">weight</span> <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="p">)</span> <span class="k">WITH</span> <span class="p">(</span>
    <span class="s1">&#39;connector&#39;</span> <span class="o">=</span> <span class="s1">&#39;sqlserver-cdc&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hostname&#39;</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
    <span class="s1">&#39;port&#39;</span> <span class="o">=</span> <span class="s1">&#39;1433&#39;</span><span class="p">,</span>
    <span class="s1">&#39;username&#39;</span> <span class="o">=</span> <span class="s1">&#39;sa&#39;</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span> <span class="o">=</span> <span class="s1">&#39;Password!&#39;</span><span class="p">,</span>
    <span class="s1">&#39;database-name&#39;</span> <span class="o">=</span> <span class="s1">&#39;inventory&#39;</span><span class="p">,</span>
    <span class="s1">&#39;table-name&#39;</span> <span class="o">=</span> <span class="s1">&#39;dbo.products&#39;</span>
<span class="p">);</span>
</pre></div>
</div>
</section>
</section>
<section id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<section id="exactly-once-processing">
<h3>Exactly-Once Processing<a class="headerlink" href="#exactly-once-processing" title="Permalink to this headline">¶</a></h3>
<p>The SQLServer CDC connector is a Flink Source connector which will read database snapshot first and then continues to read change events with <strong>exactly-once processing</strong> even failures happen. Please read <a class="reference external" href="https://debezium.io/documentation/reference/1.9/connectors/sqlserver.html#how-the-sqlserver-connector-works">How the connector works</a>.</p>
</section>
<section id="startup-reading-position">
<h3>Startup Reading Position<a class="headerlink" href="#startup-reading-position" title="Permalink to this headline">¶</a></h3>
<p>The config option <code class="docutils literal notranslate"><span class="pre">scan.startup.mode</span></code> specifies the startup mode for SQLServer CDC consumer. The valid enumerations are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">initial</span></code> (default): Takes a snapshot of structure and data of captured tables; useful if topics should be populated with a complete representation of the data from the captured tables.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">initial-only</span></code>: Takes a snapshot of structure and data like initial but instead does not transition into streaming changes once the snapshot has completed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">latest-offset</span></code>: Takes a snapshot of the structure of captured tables only; useful if only changes happening from now onwards should be propagated to topics.</p></li>
</ul>
<p><em>Note: the mechanism of <code class="docutils literal notranslate"><span class="pre">scan.startup.mode</span></code> option relying on Debezium’s <code class="docutils literal notranslate"><span class="pre">snapshot.mode</span></code> configuration. So please do not use them together. If you specific both <code class="docutils literal notranslate"><span class="pre">scan.startup.mode</span></code> and <code class="docutils literal notranslate"><span class="pre">debezium.snapshot.mode</span></code> options in the table DDL, it may make <code class="docutils literal notranslate"><span class="pre">scan.startup.mode</span></code> doesn’t work.</em></p>
</section>
<section id="single-thread-reading">
<h3>Single Thread Reading<a class="headerlink" href="#single-thread-reading" title="Permalink to this headline">¶</a></h3>
<p>The SQLServer CDC source can’t work in parallel reading, because there is only one task can receive change events.</p>
</section>
<section id="datastream-source">
<h3>DataStream Source<a class="headerlink" href="#datastream-source" title="Permalink to this headline">¶</a></h3>
<p>The SQLServer CDC connector can also be a DataStream source. You can create a SourceFunction as the following shows:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.environment.StreamExecutionEnvironment</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.functions.source.SourceFunction</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ververica.cdc.debezium.JsonDebeziumDeserializationSchema</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ververica.cdc.connectors.sqlserver.SqlServerSource</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SqlServerSourceExample</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
    <span class="n">SourceFunction</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">sourceFunction</span> <span class="o">=</span> <span class="n">SqlServerSource</span><span class="p">.</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="n">builder</span><span class="p">()</span>
      <span class="p">.</span><span class="na">hostname</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="na">port</span><span class="p">(</span><span class="mi">1433</span><span class="p">)</span>
      <span class="p">.</span><span class="na">database</span><span class="p">(</span><span class="s">&quot;sqlserver&quot;</span><span class="p">)</span> <span class="c1">// monitor sqlserver database</span>
      <span class="p">.</span><span class="na">tableList</span><span class="p">(</span><span class="s">&quot;dbo.products&quot;</span><span class="p">)</span> <span class="c1">// monitor products table</span>
      <span class="p">.</span><span class="na">username</span><span class="p">(</span><span class="s">&quot;sa&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="na">password</span><span class="p">(</span><span class="s">&quot;Password!&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="na">deserializer</span><span class="p">(</span><span class="k">new</span> <span class="n">JsonDebeziumDeserializationSchema</span><span class="p">())</span> <span class="c1">// converts SourceRecord to JSON String</span>
      <span class="p">.</span><span class="na">build</span><span class="p">();</span>

    <span class="n">StreamExecutionEnvironment</span> <span class="n">env</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="p">.</span><span class="na">getExecutionEnvironment</span><span class="p">();</span>

    <span class="n">env</span>
      <span class="p">.</span><span class="na">addSource</span><span class="p">(</span><span class="n">sourceFunction</span><span class="p">)</span>
      <span class="p">.</span><span class="na">print</span><span class="p">().</span><span class="na">setParallelism</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// use parallelism 1 for sink to keep message ordering</span>

    <span class="n">env</span><span class="p">.</span><span class="na">execute</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The SQLServer CDC incremental connector (after 2.4.0) can be used as the following shows:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.flink.api.common.eventtime.WatermarkStrategy</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.environment.StreamExecutionEnvironment</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.ververica.cdc.connectors.base.options.StartupOptions</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ververica.cdc.connectors.sqlserver.source.SqlServerSourceBuilder</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ververica.cdc.connectors.sqlserver.source.SqlServerSourceBuilder.SqlServerIncrementalSource</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ververica.cdc.debezium.JsonDebeziumDeserializationSchema</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SqlServerIncrementalSourceExample</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="n">SqlServerIncrementalSource</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">sqlServerSource</span> <span class="o">=</span>
                <span class="k">new</span> <span class="n">SqlServerSourceBuilder</span><span class="p">()</span>
                        <span class="p">.</span><span class="na">hostname</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">)</span>
                        <span class="p">.</span><span class="na">port</span><span class="p">(</span><span class="mi">1433</span><span class="p">)</span>
                        <span class="p">.</span><span class="na">databaseList</span><span class="p">(</span><span class="s">&quot;inventory&quot;</span><span class="p">)</span>
                        <span class="p">.</span><span class="na">tableList</span><span class="p">(</span><span class="s">&quot;dbo.products&quot;</span><span class="p">)</span>
                        <span class="p">.</span><span class="na">username</span><span class="p">(</span><span class="s">&quot;sa&quot;</span><span class="p">)</span>
                        <span class="p">.</span><span class="na">password</span><span class="p">(</span><span class="s">&quot;Password!&quot;</span><span class="p">)</span>
                        <span class="p">.</span><span class="na">deserializer</span><span class="p">(</span><span class="k">new</span> <span class="n">JsonDebeziumDeserializationSchema</span><span class="p">())</span>
                        <span class="p">.</span><span class="na">startupOptions</span><span class="p">(</span><span class="n">StartupOptions</span><span class="p">.</span><span class="na">initial</span><span class="p">())</span>
                        <span class="p">.</span><span class="na">build</span><span class="p">();</span>

        <span class="n">StreamExecutionEnvironment</span> <span class="n">env</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="p">.</span><span class="na">getExecutionEnvironment</span><span class="p">();</span>
        <span class="c1">// enable checkpoint</span>
        <span class="n">env</span><span class="p">.</span><span class="na">enableCheckpointing</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
        <span class="c1">// set the source parallelism to 2</span>
        <span class="n">env</span><span class="p">.</span><span class="na">fromSource</span><span class="p">(</span>
                        <span class="n">sqlServerSource</span><span class="p">,</span>
                        <span class="n">WatermarkStrategy</span><span class="p">.</span><span class="na">noWatermarks</span><span class="p">(),</span>
                        <span class="s">&quot;SqlServerIncrementalSource&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="na">setParallelism</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="p">.</span><span class="na">print</span><span class="p">()</span>
                <span class="p">.</span><span class="na">setParallelism</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

        <span class="n">env</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="s">&quot;Print SqlServer Snapshot + Change Stream&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Note:</strong> Please refer <a class="reference external" href="../about.html#deserialization">Deserialization</a> for more details about the JSON deserialization.</p>
</section>
</section>
<section id="data-type-mapping">
<h2>Data Type Mapping<a class="headerlink" href="#data-type-mapping" title="Permalink to this headline">¶</a></h2>
<div class="wy-table-responsive">
<table class="colwidths-auto docutils">
    <thead>
      <tr>
        <th class="text-left">SQLServer type<a href="https://docs.microsoft.com/en-us/sql/t-sql/data-types/data-types-transact-sql"></a></th>
        <th class="text-left">Flink SQL type<a href="{% link dev/table/types.md %}"></a></th>
      </tr>
    </thead>
    <tbody>
    <tr>
      <td>char(n)</td>
      <td>CHAR(n)</td>
    </tr>
    <tr>
      <td>
        varchar(n)<br>
        nvarchar(n)<br>
        nchar(n)
      </td>
      <td>VARCHAR(n)</td>
    </tr>
    <tr>
      <td>
        text<br>
        ntext<br>
        xml
      </td>
      <td>STRING</td>
    </tr>
    <tr>
      <td>
        decimal(p, s)<br>
        money<br>
        smallmoney
      </td>
      <td>DECIMAL(p, s)</td>
    </tr>
    <tr>
      <td>numeric</td>
      <td>NUMERIC</td>
    </tr>
    <tr>
      <td>
        float<br>
        real
      </td>
      <td>DOUBLE</td>
    </tr>
    <tr>
      <td>bit</td>
      <td>BOOLEAN</td>
    </tr>
    <tr>
      <td>int</td>
      <td>INT</td>
    </tr>
    <tr>
      <td>tinyint</td>
      <td>SMALLINT</td>
    </tr>
    <tr>
      <td>smallint</td>
      <td>SMALLINT</td>
    </tr>
    <tr>
      <td>bigint</td>
      <td>BIGINT</td>
    </tr>
    <tr>
      <td>date</td>
      <td>DATE</td>
    </tr>
    <tr>
      <td>time(n)</td>
      <td>TIME(n)</td>
    </tr>
    <tr>
      <td>
        datetime2<br>
        datetime<br>
        smalldatetime
      </td>
      <td>TIMESTAMP(n)</td>
    </tr>
    <tr>
      <td>datetimeoffset</td>
      <td>TIMESTAMP_LTZ(3)</td>
    </tr>
    </tbody>
</table>
</div>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="tidb-cdc.html" class="btn btn-neutral float-right" title="TiDB CDC Connector" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="postgres-cdc.html" class="btn btn-neutral float-left" title="Postgres CDC Connector" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2023, Ververica GmbH; Apache Flink, Flink®, Apache®, the squirrel logo, and the Apache feather logo are either registered trademarks or trademarks of The Apache Software Foundation.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  <!--
 ~ Copyright 2023 Ververica Inc.
 ~
 ~ Licensed under the Apache License, Version 2.0 (the "License");
 ~ you may not use this file except in compliance with the License.
 ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
-->



<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      version: release-2.4
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        
        <dl>
            <dt>Versions</dt>
            
            
            <dd><a href="/flink-cdc-connectors/master/">master</a></dd>
            
            
            
            <dd><a href="/flink-cdc-connectors/release-1.4/">release-1.4</a></dd>
            
            
            
            <dd><a href="/flink-cdc-connectors/release-2.0/">release-2.0</a></dd>
            
            
            
            <dd><a href="/flink-cdc-connectors/release-2.1/">release-2.1</a></dd>
            
            
            
            <dd><a href="/flink-cdc-connectors/release-2.2/">release-2.2</a></dd>
            
            
            
            <dd><a href="/flink-cdc-connectors/release-2.3/">release-2.3</a></dd>
            
            
             <strong> 
            <dd><a href="/flink-cdc-connectors/release-2.4/">release-2.4</a></dd>
             </strong> 
            
        </dl>
        
        
        <hr/>
        Free document hosting provided by <a href="http://www.readthedocs.org">Read the
        Docs</a>.

    </div>
</div>

<!-- Place this tag in your head or just before your close body tag. -->
<script async defer
        src="https://ververica.github.io/flink-cdc-connectors/release-2.4/_static/button.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>